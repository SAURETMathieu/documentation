"use strict";(self.webpackChunksauret_doc=self.webpackChunksauret_doc||[]).push([[9627],{5369:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var t=n(5893),i=n(1151);const a={id:"joi",title:"Joi",sidebar_label:"Joi"},o=void 0,s={id:"javascript/Joi/joi",title:"Joi",description:"Installation des d\xe9pendences",source:"@site/docs/javascript/Joi/schemas.md",sourceDirName:"javascript/Joi",slug:"/javascript/Joi/joi",permalink:"/documentation/docs/javascript/Joi/joi",draft:!1,unlisted:!1,editUrl:"https://github.com/SAURETMathieu/docs/javascript/Joi/schemas.md",tags:[],version:"current",frontMatter:{id:"joi",title:"Joi",sidebar_label:"Joi"},sidebar:"javascriptSidebar",previous:{title:"Init projet",permalink:"/documentation/docs/javascript/Init/"},next:{title:"Journalisation",permalink:"/documentation/docs/javascript/Logger/"}},d={},c=[{value:"Installation des d\xe9pendences",id:"installation-des-d\xe9pendences",level:2},{value:"Middleware de validation de schema",id:"middleware-de-validation-de-schema",level:2},{value:"Schemas",id:"schemas",level:2},{value:"Schema de cr\xe9ation",id:"schema-de-cr\xe9ation",level:3},{value:"Schema de modification",id:"schema-de-modification",level:3},{value:"Schema avec tableau",id:"schema-avec-tableau",level:3}];function l(e){const r={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"installation-des-d\xe9pendences",children:"Installation des d\xe9pendences"}),"\n",(0,t.jsx)(r.p,{children:"Installez les d\xe9pendances n\xe9cessaires avec la commande suivante :"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"npm i joi"})}),"\n",(0,t.jsx)(r.h2,{id:"middleware-de-validation-de-schema",children:"Middleware de validation de schema"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"import ApiError from '../errors/api.error.js';\n\nexport default (sourceProperty, schema) => async (request, _, next) => {\n  try {\n    await schema.validateAsync(request[sourceProperty]);\n    next();\n  } catch (error) {\n    next(new ApiError(error.message, { httpStatus: 400 }));\n  }\n};\n"})}),"\n",(0,t.jsx)(r.p,{children:"Utilisez ce middleware dans un routeur"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",metastring:"{4}",children:"adminArtistRouter.route('/')\n  .get(controllerWrapper(artistController.getAll.bind(artistController)))\n  .post(\n    validationMiddleware('body', artistCreateSchema),\n    controllerWrapper(artistController.create.bind(artistController)),\n  );\n"})}),"\n",(0,t.jsx)(r.h2,{id:"schemas",children:"Schemas"}),"\n",(0,t.jsxs)(r.p,{children:["Cr\xe9ez un dossier ",(0,t.jsx)(r.code,{children:"schemas"})," dans le dossier ",(0,t.jsx)(r.code,{children:"\\app"}),"\nPuis cr\xe9ez un fichier par exemple ",(0,t.jsx)(r.code,{children:"artist.create.js"})]}),"\n",(0,t.jsx)(r.h3,{id:"schema-de-cr\xe9ation",children:"Schema de cr\xe9ation"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"import Joi from 'joi';\n\nconst createArtistSchema = Joi.object({\n  firstname: Joi.string().required()\n    .error(new Error('Le pr\xe9nom de l\\'artiste est requis et doit \xeatre une cha\xeene de caract\xe8res')),\n  lastname: Joi.string().required()\n    .error(new Error('Le nom de famille de l\\'artiste est requis et doit \xeatre une cha\xeene de caract\xe8res')),\n  nickname: Joi.string().required()\n    .error(new Error('Le surnom de l\\'artiste est requis et doit \xeatre une cha\xeene de caract\xe8res')),\n  year: Joi.number().integer().min(1000).max(9999)\n    .required()\n    .error(new Error('L\\'ann\xe9e de naissance de l\\'artiste est requise et doit \xeatre au format YYYY')),\n  city: Joi.string().required()\n    .error(new Error('La ville de l\\'artiste est requis et doit \xeatre une cha\xeene de caract\xe8res')),\n  country: Joi.string().required()\n    .error(new Error('Le pays de l\\'artiste est requis et doit \xeatre une cha\xeene de caract\xe8res')),\n  description: Joi.string().required()\n    .error(new Error('La description de l\\'artiste est requise et doit \xeatre une cha\xeene de caract\xe8res')),\n  function: Joi.string().required()\n    .error(new Error('La fonction de l\\'artiste est requise et doit \xeatre une cha\xeene de caract\xe8res')),\n  url_image: Joi.string().required()\n    .error(new Error('L\\'URL de l\\'image de l\\'artiste est requise et doit \xeatre une URI valide')),\n});\n\nexport default createArtistSchema;\n"})}),"\n",(0,t.jsx)(r.h3,{id:"schema-de-modification",children:"Schema de modification"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"import Joi from 'joi';\n\nconst updateArtistSchema = Joi.object({\n  firstname: Joi.string()\n    .error(new Error('Le pr\xe9nom de l\\'artiste doit \xeatre une cha\xeene de caract\xe8res')),\n  lastname: Joi.string()\n    .error(new Error('Le nom de famille de l\\'artiste doit \xeatre une cha\xeene de caract\xe8res')),\n  nickname: Joi.string()\n    .error(new Error('Le surnom de l\\'artiste doit \xeatre une cha\xeene de caract\xe8res')),\n  year: Joi.number().integer().min(1000).max(9999)\n    .error(new Error('L\\'ann\xe9e de naissance de l\\'artiste doit \xeatre au format YYYY')),\n  city: Joi.string()\n    .error(new Error('La ville de l\\'artiste doit \xeatre une cha\xeene de caract\xe8res')),\n  country: Joi.string()\n    .error(new Error('Le pays de l\\'artiste doit \xeatre une cha\xeene de caract\xe8res')),\n  description: Joi.string()\n    .error(new Error('La description de l\\'artiste doit \xeatre une cha\xeene de caract\xe8res')),\n  function: Joi.string()\n    .error(new Error('La fonction de l\\'artiste doit \xeatre une cha\xeene de caract\xe8res')),\n  url_image: Joi.string()\n    .error(new Error('L\\'URL de l\\'image de l\\'artiste et doit \xeatre une URL valide')),\n}).required().min(1).error(new Error('Au moins un champ doit \xeatre sp\xe9cifi\xe9 pour la mise \xe0 jour'));\n\nexport default updateArtistSchema;\n"})}),"\n",(0,t.jsx)(r.h3,{id:"schema-avec-tableau",children:"Schema avec tableau"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:"import Joi from 'joi';\n\nconst updateArtistsOrderSchema = Joi.object().keys({\n  orders: Joi.array().items(\n    Joi.object({\n      artistId: Joi.number().integer().positive().required()\n        .error(new Error('L\\'id de l\\'artiste doit \xeatre un nombre entier positif')),\n    }),\n  ).min(1).required()\n    .error(new Error('L\\'ordre doit contenir au moins un \xe9l\xe9ment')),\n});\n\nexport default updateArtistsOrderSchema;\n"})})]})}function u(e={}){const{wrapper:r}={...(0,i.a)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},1151:(e,r,n)=>{n.d(r,{Z:()=>s,a:()=>o});var t=n(7294);const i={},a=t.createContext(i);function o(e){const r=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(a.Provider,{value:r},e.children)}}}]);