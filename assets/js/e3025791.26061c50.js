"use strict";(self.webpackChunksauret_doc=self.webpackChunksauret_doc||[]).push([[3775],{2760:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>u,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var s=n(5893),t=n(1151);const o={id:"error-centralize",title:"Centralisation des Erreurs",sidebar_label:"Centralisation des Erreurs",description:"Centralisation des erreurs sur un serveur express Node.js"},a=void 0,i={id:"javascript/error/error-centralize",title:"Centralisation des Erreurs",description:"Centralisation des erreurs sur un serveur express Node.js",source:"@site/docs/javascript/error/errorCentralize.md",sourceDirName:"javascript/error",slug:"/javascript/error/error-centralize",permalink:"/documentation/docs/javascript/error/error-centralize",draft:!1,unlisted:!1,editUrl:"https://github.com/SAURETMathieu/docs/javascript/error/errorCentralize.md",tags:[],version:"current",frontMatter:{id:"error-centralize",title:"Centralisation des Erreurs",sidebar_label:"Centralisation des Erreurs",description:"Centralisation des erreurs sur un serveur express Node.js"},sidebar:"javascript",previous:{title:"Error",permalink:"/documentation/docs/javascript/error"},next:{title:"Express",permalink:"/documentation/docs/javascript/express"}},u={},l=[{value:"Cr\xe9ation d&#39;une Classe \xe9tendant la Classe Error",id:"cr\xe9ation-dune-classe-\xe9tendant-la-classe-error",level:2},{value:"Int\xe9gration d&#39;un Gestionnaire d&#39;Erreurs",id:"int\xe9gration-dun-gestionnaire-derreurs",level:2},{value:"Ajout de la Route dans le Routeur",id:"ajout-de-la-route-dans-le-routeur",level:3},{value:"Utilisation de next",id:"utilisation-de-next",level:3},{value:"Importation du module dans le routeur",id:"importation-du-module-dans-le-routeur",level:3}];function d(e){const r={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"cr\xe9ation-dune-classe-\xe9tendant-la-classe-error",children:"Cr\xe9ation d'une Classe \xe9tendant la Classe Error"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-js",children:"// Centraliser les erreurs\nclass ApiError extends Error {\n  /**\n   * Construit une instance de ApiError.\n   * @param {string} message - Le message d'erreur.\n   * @param {Object} info - Informations suppl\xe9mentaires sur l'erreur.\n   */\n  constructor(message, info) {\n    super(message);\n    this.name = 'ApiError';\n\n    // Attache des informations suppl\xe9mentaires \xe0 l'objet d'erreur si fournies\n    if (info) {\n      Object.entries(info).forEach(([key, value]) => {\n        this[key] = value;\n      });\n    }\n  }\n}\n\nmodule.exports = ApiError;\n"})}),"\n",(0,s.jsx)(r.h2,{id:"int\xe9gration-dun-gestionnaire-derreurs",children:"Int\xe9gration d'un Gestionnaire d'Erreurs"}),"\n",(0,s.jsx)(r.h3,{id:"ajout-de-la-route-dans-le-routeur",children:"Ajout de la Route dans le Routeur"}),"\n",(0,s.jsxs)(r.p,{children:["Cr\xe9ez le module ",(0,s.jsx)(r.code,{children:"errorHandler"})," qui vous permettra de r\xe9cup\xe9rer les erreurs ",(0,s.jsx)(r.code,{children:"(err)"})," g\xe9n\xe9r\xe9es dans vos middlewares qui appelleront ce module."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-js",children:"// Importer le module de journalisation (logger) et le module d'envoi d'e-mails (nodemailer)\nconst logger = require('./index.logger.js');\nconst { sendEmail } = require('./nodemailer.js');\n\n// Middleware pour g\xe9rer les erreurs\nmodule.exports = async (err, request, response, next) => {\n  try {\n    // Si aucune erreur, passez au middleware suivant\n    if (!err) {\n      next();\n    }\n\n    // Si l'erreur a un statut HTTP de 500 (Internal Server Error)\n    if (err.httpStatus === 500) {\n      // Enregistrer l'erreur dans les journaux\n      logger.error('Error 500', err);\n      // Pr\xe9parer les d\xe9tails de l'e-mail \xe0 envoyer\n      const destinataire = process.env.MAIL;\n      const sujet = 'Erreur 500 sur le site';\n      const contenu = `Le site rencontre des probl\xe8mes. \n      D\xe9tails de l'erreur :\\n\\n${err.stack}`;\n\n      // Envoyer un e-mail pour avertir en cas d'erreur 500\n      const envoiReussi = await sendEmail(destinataire, sujet, contenu);\n\n      // Afficher une erreur si l'envoi de l'e-mail \xe9choue\n      if (!envoiReussi) {\n        console.error('Erreur lors de l\\'envoi de l\\'e-mail.');\n      }\n    }\n\n    // Retourner une r\xe9ponse JSON avec le statut HTTP de l'erreur et le message de l'erreur\n    return response.status(err.httpStatus).json({ error: err.message });\n  } catch (error) {\n    logger.error('Error in error handling middleware', error);\n    // Retourner une r\xe9ponse JSON avec le statut HTTP 500 en cas d'\xe9chec du traitement de l'erreur\n    return response.status(500).json('Erreur lors de la gestion de l\\'erreur.');\n  }\n};\n"})}),"\n",(0,s.jsx)(r.h3,{id:"utilisation-de-next",children:"Utilisation de next"}),"\n",(0,s.jsxs)(r.p,{children:["Dans un middleware, vous pourrez cr\xe9er une erreur de cette mani\xe8re, en retournant ",(0,s.jsx)(r.code,{children:"next"})," avec l'erreur comme param\xe8tre. N'oubliez pas d'importer la classe ",(0,s.jsx)(r.code,{children:"ApiError"})," qui sera n\xe9cessaire pour son utilisation ainsi que ",(0,s.jsx)(r.code,{children:"next"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-js",metastring:"{1}",children:"const ApiError = require('../errors/api.error.js');\n\nconst err = new ApiError(\n        'La rotation n\\'existe pas.',\n        { httpStatus: 404 },\n      );\n      return next(err);\n"})}),"\n",(0,s.jsx)(r.h3,{id:"importation-du-module-dans-le-routeur",children:"Importation du module dans le routeur"}),"\n",(0,s.jsxs)(r.p,{children:["Importez le module ",(0,s.jsx)(r.code,{children:"errorHandler"})," avec le bon chemin, puis ajoutez une route pour attraper les erreurs g\xe9n\xe9r\xe9es dans une route pr\xe9c\xe9dente. Placez cette route \xe0 la fin de mani\xe8re \xe0 ne pas cr\xe9er d'erreurs. Prenez soin de mettre ce middleware avant le middleware de la page d'erreur, qui devra \xeatre le dernier middleware en cas de ",(0,s.jsx)(r.code,{children:"page not found"}),"."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-js",metastring:"{4,10}",children:"const express = require('express');\nconst webSiteRouter = require('./webSite/index.js');\nconst mainController = require('../controllers/mainController.js');\nconst errorHandler = require('../helpers/error.handler.js');\n\nconst router = new express.Router();\n\nrouter.use('/', webSiteRouter);\n\nrouter.use(errorHandler);\n\nrouter.use('*', mainController.getErrorPage);\n\nmodule.exports = router;\n"})})]})}function c(e={}){const{wrapper:r}={...(0,t.a)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,r,n)=>{n.d(r,{Z:()=>i,a:()=>a});var s=n(7294);const t={},o=s.createContext(t);function a(e){const r=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);